
## Виртуальные машины (Compute Instances)

**Виртуальные машины (ВМ)** - это масштабируемые вычислительные ресурсы, предоставляемые «как услуга» (IaaS). Они позволяют запускать и управлять собственными серверами с полным контролем над операционной системой и установленным программным обеспечением, не приобретая и не обслуживая физическое оборудование.

### Ключевые возможности

- **Гибкая конфигурация**: Выбор vCPU, объема оперативной памяти, типа и размера диска под конкретные задачи.
- **Широкий выбор ОС**: Предустановленные образы популярных операционных систем (Windows Server, различные дистрибутивы Linux) или загрузка собственных.
- **Быстрое развертывание**: Запуск новой ВМ от нескольких десятков секунд до нескольких минут.
- **Эластичное масштабирование**: Возможность увеличения или уменьшения вычислительных ресурсов (vCPU, RAM) в зависимости от нагрузки (Вертикальное масштабирование).
- **Автомасштабирование**: Создание групп виртуальных машин, которые автоматически добавляют или удаляют инстансы на основе заданных метрик (например, загрузка CPU).
- **Интеграция с облачной сетью**: Гибкая настройка сетевых интерфейсов, firewall'ов, балансировщиков нагрузки и VPN.
- **Высокая доступность**: Размещение ВМ в разных зонах доступности внутри региона для обеспечения отказоустойчивости.
- **Резервное копирование**: Автоматическое создание снапшотов дисков для восстановления данных и всей конфигурации ВМ.

### Компоненты виртуальной машины

При создании ВМ вы настраиваете следующие компоненты:

| Компонент | Описание | Примеры |
| :--- | :--- | :--- |
| **Образ (Image)** | Шаблон с предустановленной ОС и часто используемым ПО. | Ubuntu 22.04 LTS, Windows Server 2022, CentOS Stream 9 |
| **Тип инстанса (Flavor)** | Предопределенная конфигурация vCPU и RAM. | small (1vCPU, 2GB RAM), medium (2vCPU, 4GB RAM), highmem (4vCPU, 16GB RAM) |
| **Диск (Volume)** | Блочное устройство хранения данных. Может быть SSD (высокая производительность) или HDD (экономичное хранение). | SSD 20 GB, HDD 100 GB |
| **Сеть (Network)** | Виртуальная сеть, к которой подключается ВМ. Настройка IP-адресов (внутренних и внешних), групп безопасности (firewall). | default-network, my-app-subnet |
| **Ключевая пара (Key Pair)** | Пара SSH-ключей для безопасного доступа к ВМ на Linux. | my-ssh-key (публичный ключ загружается в облако, приватный хранится у пользователя) |

### Жизненный цикл виртуальной машины

ВМ может находиться в следующих состояниях:

- **Запуск (Booting)**: Система инициализирует и запускает инстанс.
- **Работает (Running)**: ВМ активна и готова к работе.
- **Остановлена (Stopped)**: ВМ выключена, но ее конфигурация (vCPU, RAM, диск) сохранена. Плата за вычисления не взимается, плата за диск продолжает начисляться.
- **Перезагружена (Rebooted)**: Мягкая или жесткая перезагрузка операционной системы.
- **Удалена (Deleted)**: ВМ и все связанные с ней ресурсы (если не указано иное) безвозвратно удаляются.

### Управление виртуальными машинами

Управление ВМ возможно через несколько интерфейсов:

- Панель управления (Web UI): Интуитивно понятный графический интерфейс для полного цикла управления.
- Командная строка (CLI): Мощный инструмент для автоматизации и управления из скриптов.
- API: Прямое взаимодействие с платформой для интеграции в ваши приложения и системы CI/CD.

Пример создания ВМ через CLI:


```
# Создание ВМ с именем 'my-web-server'
cloud compute instance create my-web-server 
--image "Ubuntu-22.04" 
--flavor "small" 
--key-name "my-ssh-key" 
--network "default-network" 
--volume-size 20
```

### Типы дисков

- **Локальный диск (Local SSD)**: Физически находится на гипервизоре. Высокая производительность, но данные теряются при остановке или перемещении ВМ. Подходит для кэшей и временных данных.
- **Сетевой диск (Network Volume)**: Независимое блочное устройство, подключенное по сети. Данные сохраняются при остановке ВМ. Диск можно отключать от одной ВМ и подключать к другой. Рекомендуется для большинства рабочих нагрузок.

### Сетевые настройки и безопасность

- **Группы безопасности (Security Groups)**: Виртуальный файрвол, управляющий входящим и исходящим трафиком ВМ.
    – *Пример правила:* Разрешить входящий трафик на порт 80 (HTTP) и 22 (SSH) с любых IP-адресов.
- **Публичный IP-адрес**: Динамический или статический адрес для доступа к ВМ из интернета.
- **Внутренний IP-адрес**: Адрес для коммуникации между ВМ внутри одной облачной сети.

### Рекомендации и лучшие практики

1. **Используйте группы автомасштабирования (Auto Scaling Groups)**: Для обеспечения высокой доступности и обработки пиковых нагрузок.
2. **Регулярно создавайте снапшоты**: Перед обновлением ПО или изменением конфигурации создавайте снимки дисков.
3. **Применяйте принцип минимальных привилегий в группах безопасности**: Открывайте только те порты, которые действительно необходимы для работы сервиса.
4. **Разделяйте среды**: Используйте разные сети или проекты для разработки, тестирования и продакшена.
5. **Мониторьте метрики**: Следите за утилизацией CPU, RAM и дискового I/O, чтобы своевременно масштабировать ресурсы.
6. **Используйте Cloud-Init**: Для автоматической настройки ВМ при первом запуске (установка пакетов, настройка пользователей, запуск скриптов).

### Ограничения (Quotas)

Для каждого проекта действуют **квоты** на максимальное количество одновременно запущенных ВМ, vCPU, объем RAM и дискового пространства. Увеличить квоты можно через обращение в техническую поддержку.

