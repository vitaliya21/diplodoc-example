name: Sync to GitFlic

on:
  push:
    branches:
      - main # Или master, или другие ветки, которые вы хотите синхронизировать
      # Если вы хотите синхронизировать все ветки, просто оставьте 'push:'
      # без 'branches:' или добавьте все нужные ветки.
      # Если хотите синхронизировать теги, добавьте:
      # tags:
      #   - '*'

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # Важно для получения всей истории, включая все ветки и теги

    - name: Set up Git
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"

    - name: Push to GitFlic
      run: |
        echo "Token variable length: ${{ secrets.GITFLIC_TOKEN }}" | wc -c
        git config --global credential.https://gitflic.ru.username ${{ secrets.GITFLIC_TOKEN }}
        git remote add gitflic https://${{ secrets.GITFLIC_TOKEN }}@gitflic.ru/vitazhuravleva/dokumentaciya.git
        git push --mirror gitflic
      env:
        GIT_SSH_COMMAND: "ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no" # Для SSH, но здесь используется HTTPS
        

